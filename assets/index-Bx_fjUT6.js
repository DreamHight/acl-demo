import{K as y,al as R,Z as w,X as oe,V as _,W as te,y as g,aW as ne,at as p,r as P,d as N,E as K,a3 as j,j as r,aR as $,aX as F,D as G,a2 as ae,ad as M,k as Y,v as Z,O as H,a0 as se,o as le,aa as ce,F as re,aY as ie,G as B,L as T,J as ue,I as de,N as fe,ao as ve,aZ as ye}from"./index-D2isMtcO.js";import{a as me,u as he,b as E}from"./use-scope-id-Ch-AIWoj.js";import{c as Ie}from"./interceptor-BAKq_hND.js";const U={show:Boolean,zIndex:w,overlay:y,duration:w,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:R,transitionAppear:Boolean,closeOnClickOverlay:y},Be=Object.keys(U);let h=0;const D="van-overflow-hidden";function Oe(e,o){const n=me(),f="01",s="10",c=i=>{n.move(i);const v=n.deltaY.value>0?s:f,b=ne(i.target,e.value),{scrollHeight:m,offsetHeight:O,scrollTop:C}=b;let u="11";C===0?u=O>=m?"00":"01":C+O>=m&&(u="10"),u!=="11"&&n.isVertical()&&!(parseInt(u,2)&parseInt(v,2))&&p(i,!0)},a=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",c,{passive:!1}),h||document.body.classList.add(D),h++},l=()=>{h&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",c),h--,h||document.body.classList.remove(D))},S=()=>o()&&a(),I=()=>o()&&l();oe(S),_(I),te(I),g(o,i=>{i?a():l()})}function V(e){const o=P(!1);return g(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const[Ce,ke]=K("overlay"),we={show:Boolean,zIndex:w,duration:w,className:R,lockScroll:y,lazyRender:y,customStyle:Object,teleport:[String,Object]};var Pe=N({name:Ce,props:we,setup(e,{slots:o}){const n=P(),f=V(()=>e.show||!e.lazyRender),s=a=>{e.lockScroll&&p(a,!0)},c=f(()=>{var a;const l=G(ae(e.zIndex),e.customStyle);return M(e.duration)&&(l.animationDuration="".concat(e.duration,"s")),Y(r("div",{ref:n,style:l,class:[ke(),e.className]},[(a=o.default)==null?void 0:a.call(o)]),[[Z,e.show]])});return j("touchmove",s,{target:n}),()=>{const a=r($,{name:"van-fade",appear:!0},{default:c});return e.teleport?r(F,{to:e.teleport},{default:()=>[a]}):a}}});const Se=H(Pe),be=G({},U,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[xe,L]=K("popup");var Te=N({name:xe,inheritAttrs:!1,props:be,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:f}){let s,c;const a=P(),l=P(),S=V(()=>e.show||!e.lazyRender),I=se(()=>{const t={zIndex:a.value};if(M(e.duration)){const d=e.position==="center"?"animationDuration":"transitionDuration";t[d]="".concat(e.duration,"s")}return t}),i=()=>{s||(s=!0,a.value=e.zIndex!==void 0?+e.zIndex:ie(),o("open"))},v=()=>{s&&Ie(e.beforeClose,{done(){s=!1,o("close"),o("update:show",!1)}})},b=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&v()},m=()=>{if(e.overlay)return r(Se,B({show:e.show,class:e.overlayClass,zIndex:a.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},E(),{onClick:b}),{default:f["overlay-content"]})},O=t=>{o("clickCloseIcon",t),v()},C=()=>{if(e.closeable)return r(de,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),ue],classPrefix:e.iconPrefix,onClick:O},null)};let u;const W=()=>{u&&clearTimeout(u),u=setTimeout(()=>{o("opened")})},X=()=>o("closed"),J=t=>o("keydown",t),q=S(()=>{var t;const{destroyOnClose:d,round:x,position:k,safeAreaInsetTop:Q,safeAreaInsetBottom:ee,show:A}=e;if(!(!A&&d))return Y(r("div",B({ref:l,style:I.value,role:"dialog",tabindex:0,class:[L({round:x,[k]:k}),{"van-safe-area-top":Q,"van-safe-area-bottom":ee}],onKeydown:J},n,E()),[(t=f.default)==null?void 0:t.call(f),C()]),[[Z,A]])}),z=()=>{const{position:t,transition:d,transitionAppear:x}=e,k=t==="center"?"van-fade":"van-popup-slide-".concat(t);return r($,{name:d||k,appear:x,onAfterEnter:W,onAfterLeave:X},{default:q})};return g(()=>e.show,t=>{t&&!s&&(i(),n.tabindex===0&&fe(()=>{var d;(d=l.value)==null||d.focus()})),!t&&s&&(s=!1,o("close"))}),he({popupRef:l}),Oe(l,()=>e.show&&e.lockScroll),j("popstate",()=>{e.closeOnPopstate&&(v(),c=!1)}),le(()=>{e.show&&i()}),ce(()=>{c&&(o("update:show",!0),c=!1)}),_(()=>{e.show&&e.teleport&&(v(),c=!0)}),ve(ye,()=>e.show),()=>e.teleport?r(F,{to:e.teleport},{default:()=>[m(),z()]}):r(re,null,[m(),z()])}});const Ee=H(Te);export{Ee as P,U as a,Be as p};
